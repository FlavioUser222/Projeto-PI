<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistir V√≠deo</title>
    <link rel="stylesheet" href="./styles/video.css">
</head>

<body>

    <header>
        <img src="" alt="Inclusive.com">
    </header>

    <div class="goBack">
        <a href="inclusive.html">Seta para voltar para in√≠cio<img src="../imagens/seta-esquerda.png" alt="Seta de Voltar"></a>
    </div>

    <div class="container">

        <div class="acessibilidade">
            <a href="javascript:void(0)" onclick="clickAcessibilidade()"><img src="../imagens/acessibilidade.png"
                    alt=""></a>
            <div class="options-acessibilidade" id="optionsAcessibilidade">
                <a href="javascript:void(0)" id="btnContraste"><img src="../imagens/contrast.png"
                        alt="√çcone contraste">Alto contraste</a>
                <a href="javascript:void(0)" id="btnMais"><img src="../imagens/mais.png" alt="Simbolo soma">Aumentar a
                    fonte</a>
                <a href="javascript:void(0)" id="btnMenos"><img src="../imagens/minus-big-symbol.png"
                        alt="Simbolo de subtra√ß√£o">Diminuir a fonte</a>
                <a href="javascript:void(0)" id="btnDaltonismo"><img src="../imagens/color-blindness-test.png"
                        alt="√çcone daltonismo">Daltonismo</a>
            </div>
        </div>

        <h1 id="tituloVideo"></h1>
        <video id="videoPlayer" controls class="video">
            <track id="legendaPt" label="Portugu√™s" kind="subtitles" srclang="pt" src="" default>
        </video>

        <p id="descricao"></p>

    </div>



    <script>
        const params = new URLSearchParams(window.location.search);
        const videoId = params.get('id');
        let fontSize = parseInt(localStorage.getItem('fontSize'), 10) || 20


        if (videoId) {
            fetch('https://projeto-pi-onrender.onrender.com/videos')
                .then(res => res.json())
                .then(videos => {
                    const video = videos.find(v => v.id == videoId);

                    if (videoId) {
                        fetch('https://projeto-pi-onrender.onrender.com/videos')
                            .then(res => res.json())
                            .then(videos => {
                                const video = videos.find(v => v.id == videoId)
                                if (video) {
                                    document.getElementById('tituloVideo').innerText = video.nome

                                    legendaPt.src = `https://projeto-pi-onrender.onrender.com/uploads/${video.legenda}`

                                    videoPlayer.src = `https://projeto-pi-onrender.onrender.com/uploads/${video.video}`

                                    document.getElementById('descricao').innerText = video.descricao


                                    legendaPt.addEventListener('load', () => {
                                        videoPlayer.textTracks[0].mode = 'showing'; // for√ßa a exibi√ß√£o da legenda
                                    });
                                }
                            });
                    }
                });
        }


        function clickAcessibilidade() {
            const options = document.getElementById("optionsAcessibilidade");
            const isVisible = options.style.display === "flex";
            options.style.display = isVisible ? "none" : "flex";
        }

        function autoContraste() {
            document.body.classList.toggle('alto-contraste')
            if (document.body.classList.contains('alto-contraste')) {
                localStorage.setItem('modoContraste', 'ativo');
            } else {
                localStorage.removeItem('modoContraste');
            }
        }

        function aplicarTamanhoDaFonte() {
            document.body.style.fontSize = fontSize + 'px'
            localStorage.setItem('fontSize', fontSize)
        }

        function aumentarFonte(e) {
            if (e && e.preventDefault) e.preventDefault()

            if (fontSize < 32) {
                fontSize += 2
                aplicarTamanhoDaFonte()
            }
        }
        function diminuirFonte(e) {
            if (e && e.preventDefault) e.preventDefault()
            if (fontSize > 20) {
                fontSize -= 2
                aplicarTamanhoDaFonte()
            }
        }

        function aplicarDaltonismo(tipo) {
            document.body.classList.remove('protanopia', 'deuteranopia', 'tritanopia')

            if (tipo) {
                document.body.classList.add(tipo)
                localStorage.setItem('modoDaltonismo', tipo)
            } else {
                localStorage.removeItem('modoDaltonismo')
            }
        }

        function ativarDaltonismo() {
            const modoAtual = localStorage.getItem('modoDaltonismo')
            let novoModo;

            if (modoAtual === 'protanopia') {
                novoModo = 'deuteranopia'
                alert('üîµ Modo Daltonismo: Deuteranopia ativado')
            } else if (modoAtual === 'deuteranopia') {
                novoModo = 'tritanopia'
                alert('üü¢ Modo Daltonismo: Tritanopia ativado')
            } else if (modoAtual === 'tritanopia') {
                novoModo = null;
                alert('üîÅ Modo Daltonismo desativado')
            } else {
                novoModo = 'protanopia'
                alert('üî¥ Modo Daltonismo: Protanopia ativado')
            }

            aplicarDaltonismo(novoModo)
        }

        document.getElementById('btnDaltonismo').addEventListener('click', ativarDaltonismo);

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btnContraste').addEventListener('click', autoContraste)

            const btnMais = document.getElementById('btnMais');
            const btnMenos = document.getElementById('btnMenos');

            if (btnMais) btnMais.addEventListener('click', aumentarFonte);
            if (btnMenos) btnMenos.addEventListener('click', diminuirFonte);
            aplicarTamanhoDaFonte()

            const salvo = localStorage.getItem('modoDaltonismo');
            if (salvo) aplicarDaltonismo(salvo)

            if (localStorage.getItem('modoContraste') === 'ativo') {
                document.body.classList.add('alto-contraste');
            }

        })

        window.addEventListener('scroll', () => {
            const footer = document.querySelector('footer')
            const scrollTop = window.scrollY + window.innerHeight
            const docHeight = document.documentElement.scrollHeight

            if (scrollTop >= docHeight - 10) {
                footer.classList.add('show');
            } else {
                footer.classList.remove('show');
            }
        })




    </script>
</body>

</html>